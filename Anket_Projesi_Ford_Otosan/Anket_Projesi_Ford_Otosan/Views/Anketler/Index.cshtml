
@{
    ViewBag.Title = "Anketler";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model Anket_Projesi_Ford_Otosan.Models.Anket

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<style>

    .container {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card {
        color: #fff;
        background-color: blue;
        transition: background-color 0.4s ease-in-out 0.1s;
        border-radius: 0;
        padding-top: 15px;
        padding-bottom: 15px;
    }

        .card:hover {
            background-color: #a4a6a6;
            cursor: pointer;
        }

    .card-text {
        color: #fff;
    }

    .btn {
        border-radius: 0;
        padding-left: 14px;
        margin-top: 10px;
        margin-right: 10px;
    }

        .btn:hover {
            opacity: 1;
        }
</style>


<div class="container row row-cols-1 row-cols-md-3 g-4 " style="position:relative;margin:auto;">
    @foreach (var item in Model.AnketList.Item1)
    {
        int sayac = 0;
        foreach (var item2 in Model.AnketList.Item2)
        {
            if (item2.CD_ANKET_ID == item.SQ_ANKET_ID)
            {
                sayac++;

            }
        }
        if ((item.DT_YAYIN_TARIHI <= DateTime.Now) && (item.DT_BITIS_TARIHI >= DateTime.Today))
        {
            <div class="card border-light mx-1" style="max-width: 18rem">
                <div class="card-header bg-transparent border-light" id="ankAd">Anket Adı: @item.CH_ANKET </div>
                <div class="card-body text-black">
                    <p class="card-text">Soru Sayısı: @sayac</p>
                </div>
                <div class="card-footer bg-transparent border-light">

                    Yayın Tarihi: @item.DT_YAYIN_TARIHI.ToString("dd.MMM.yyyy") <br /> Bitiş Tarihi: @item.DT_BITIS_TARIHI.ToString("dd.MMM.yyyy")

                </div>
                <div class="card-footer bg-transparent border-light d-flex justify-content-between">
                    <button id="cvpbtn" class="btn btn-success" onclick="CevaplaScript(@item.SQ_ANKET_ID)" data-dismiss="modal" >Cevapla</button>
                    <button type="button" class="btn btn-warning" @if (ViewBag.Yetki == false) { <text> hidden</text>}>
                        Güncelle
                    </button>
                    <button type="button" class="btn btn-danger" @if (ViewBag.Yetki == false) { <text> hidden</text>}>
                        Sil
                    </button>
                </div>
            </div>
        }




    }


    <!-- The Modal -->
    <div class="modal fade" id="CevaplaModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div  class="modal-header">
                    <h2 id="CevaplaModalheader"> </h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <h6 id="sorubody"></h6>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>
</div>

<script>

    function CevaplaScript(SQ_ANKET_ID) {
        $("#CevaplaModal").modal("show");
        debugger;
        var model = {
            rowId:SQ_ANKET_ID
        };
        debugger
        var url = "/Anketler/Cevapla?SQ_ANKET_ID=" + SQ_ANKET_ID;
        //$("#myModal").modal();
        $.ajax({
            type:"POST",
            url: url,
            data: JSON.stringify(model),
            contentType: "application/json",
        }).done(function (res) {
            debugger

            var obj = JSON.parse(res.Data);
            $("#CevaplaModalheader").html(obj.title);
            var sayac = 0;
            for (var i = 0; i < obj.sorular.length; i++) {
                if (sayac == 0) {
                    if (i == 0) {
                        sayac++;
                        $("#sorubody").html(obj.sorular[i].soru);
                        break;
                    }
                }
                else {
                    $("#sorubody").html(obj.sorular[i].soru);
                }
                
            }
           
            
            
        });
    }

       
</script>

